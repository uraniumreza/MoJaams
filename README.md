# MoJaams

## Description

Imagine a pizza ordering services with the following functionality:

1. Order a pizza:
   - Specify the desired pizza type (margarita, marinara, salami), the number of pizza items and their size (small, medium, large).
     Example: 1 x Salami small, 2 x Marinara large, 1 x Salami medium
   - An order should contain information about the customer: name, address
   - It should be possible to track the status of order delivery. (new, preparing, delivering, delivered)
2. Update an order:
   - There should be a possibility to update the order details (pizzas/number of pizzas/size)
   - There should be a possibility to change the status of order delivery
   - A order in some delivery statuses (e.g. delivered) could not be updated
3. Remove an order
4. Retrieve an order
5. List orders
   - Provide filtering by status/customer

## Database Modelling

I've created 5 tables for the solution of the task. Used `sequelize` with `postgreSQL` for migration, seed and quering from the tables.

1. `Items` for storing pizza-items related information i.e. `name` and `status`. Default status of each item is `active`.
   We can `inactive` a particular item, so that end-users won't see a particular item.
2. `Variants` for storing different variations e.g. large, medium etc. Here, we have only the `name` field.
3. `ItemVariants` is basically the table to normalize the many-many relationship between `Items` and `Variants`;
   here we'll have `itemId`, `variantId` and `status` to identify each item variation. Now, this table has one-many relationship
   with other two tables. For simplicity, I'm assuming that each item will have atleast one variant!
4. `Orders` to keep customer information i.e. `name` and `address` and the `status` of the order. Initial status of each order
   is `pending`.
5. `OrderItems` is to store all the order-items and their `quantity`. Each order-item has a `status` so that a order-item
   can be `cancelled` separately.

## Backend

I've used express.js to develop the RESTful api service. Also used `joi` from hapi.js to create my own `validator` middleware for
`request` object validation. Created a global `error-handler` along with extending `Error` object to create a `customError`.
Used `Jest` and `supertest` for unit testing the `services` and integration testing the routes/end-points.

### Folder Structure

| filename           | description                                          |
| ------------------ | ---------------------------------------------------- |
| bin/www            | contains the server                                  |
| config/config.json | sequelize config file                                |
| src/\_\_tests\_\_  | contains all the unit-tests and integration-tests    |
| src/controllers    | defines all the end-points                           |
| src/middlewares    | contains all the middlewares                         |
| src/migrations     | all the migration files generated by sequelize       |
| src/models         | contains data-models of each table                   |
| src/seeders        | seed-data to initialize the database with dummy data |
| src/services       | contains all the business-logics for controllers     |

### APIs

[TODO: ADD POSTMAN COLLECTION]

1. Get item list filtered with `status` (_optional_, if not sent fetch all items regardless of the `status`)

```
GET :: /api/v1/items?status=active
```

2. Create a single item; just need to send the `name`

```
POST :: /api/v1/items
```

3. Create a variant with name; same as item

```
POST :: /api/v1/variants
```

4. Retrieve information of a single variant

```
GET :: /api/v1/variants/:variantId
```

5. Get all the item-variants filtered with `status`

```
GET :: /api/v1/item-variants
```

6. Create a order with `customerName`, `customerAddress` and `items`

```
POST :: /api/v1/orders
```

7. Get order-list filtered-by `status` and `customerName`; support of pagination

```
GET :: /api/v1/orders
```

7. Retrieve a particular order detail

```
GET :: /api/v1/orders/:orderId
```

8. Update a particular order information; also update order-items information

```
PATCH :: /api/v1/orders/:orderId
```

I didn't implement the api for deleting a particular order. because I believe for any business, deleting information is not
a very good choice. That's why I've introduced the `status=canceled` to mark a order as deleted/canceled. So, for deleting/canceling an
order we can use the `patch` api to update the status to _canceled_.

### Tests

As the order-create is the super important service of this project, I wrote unit-tests for the createOrder service and integration-tests
for create-order api end-point! Also wrote unit-tests for items and item-variants services. Here's the code-coverage report -

![Code coverage report of Backend service](https://i.imgur.com/7hp5HaF.png)

## Frontend

I've used `create-react-app` to bootstrap the project. As the main task is to build a somplified UI to place an order; I didn't use `react-router`, I believe it could be a overhead for this task. Also I didn't use any state management tools e.g. `redux`/`mobx`, the reason behind it is also same. The amount of data/state we had to manage for this task is too little to jump into configuring `redux`. I've used `prop-types` for static type checking for all the components. In all of my previous projects I've used `axios` for network request client; but recently the react community is hyped with `use-http` hooks and it's awesome usage, that's why I tried `useFetch` hook from `use-http` in this project.

### Folder Structure

Everything under `src` directory -

| filename      | description                         |
| ------------- | ----------------------------------- |
| \_\_tests\_\_ | contains all the snapshot-tests     |
| components    | contains all components             |
| App.js        | root component; container-component |
| App.css       | all the styles                      |

## Running Project

First, we need to clone the repo -

```
git clone git@github.com:uraniumreza/MoJaams.git
```

Then, we'll build our docker containers -

```
docker-compose up --build
```

Wait now all our docker containers are up; and we'll run the database creation (both `dev` and `test`), migration and seed scripts -

```
docker exec --user postgres mojaams_db /bin/sh -c 'createdb mojaams_test; createdb mojaams_dev;'
docker exec mojaams_backend /bin/sh -c "npx sequelize-cli db:migrate; npx sequelize-cli db:seed:all;"
```

So, our services are up; we can test now here - [MoJaams](localhost)

### Running Tests

#### Backend

```
docker exec mojaams_backend /bin/sh -c "npx sequelize-cli db:migrate; npx sequelize-cli db:seed:all;"
```

#### Frontend

```

```
